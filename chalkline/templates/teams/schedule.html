<head>
    <link rel="stylesheet" href="{{url_for('static', filename='schedule.css')}}">
    <script src="{{url_for('static', filename='schedule.js')}}" defer></script>
</head>

{% extends "design.html" %}
{% block title %}Team Schedule{% endblock title %}

{% block content %}
<main>
    <div>
        <h1>Team Schedule</h1>
        <h3>Your teams: {{res.user.teams|join(', ')}}</h3>
    </div>

    <button type="" onclick="toggleFilterSection('filter-section')" class="filter-dropdown action"><i class="fa-solid fa-filter"></i> Filters</button>
    <form method="post">
        
        <h3 class="error">{{res.msg}}</h3>
        <section class="schedule-section scrollwrapper">
            {% if events|length < 1 %}
            <h3 class="error">No events found. Try the <a href="{{url_for('league.master_schedule')}}">Master Schedule</a></h3>
            {% endif %}
            <table id="schedule-table" class="event-display">
                <tr>
                    <th></th>
                    <th>Event</th>
                    <th>Date</th>
                    <th>Venue</th>
                    <th>Field</th>
                    <th>Status</th>
                    <th>Away</th>
                    <th>Home</th>
                    <th>Umpire Duty</th>
                    
                </tr>
                {% for e in events %}
                <tr class="event-row">
                    <td><a class="icon-link" href="{{url_for('view_info.event', eventId=e._id)}}"><i class="fa-solid fa-info"></i></a></td>
                    <td class="event-type">{{e.type}}</td>
                    <td>{{e.date.strftime('%a %m/%d @ %H:%M')}}</td>
                    <td>{{e.venueId}}</td>
                    <td>{{e.field}}</td>
                    <td>{{e.status}}</td>
                    <td>{{e.away}}</td>
                    <td>{{e.home}}</td>
                    <td><button type="button" onclick="openPopup('{{e._id}}')" class="schedule-action">view</button></td>

                    <dialog class="popup" id="popup_{{e._id}}">
                        <a onclick="closePopup('{{e._id}}')" class="error"><i class="fa-solid fa-xmark"></i> Close</a>
                        <h3>{{e.age}}: {{e.venueId}}, {{e.leagueId}}</h3>
                        <h4>Field {{e.field}} @ {{e.date.strftime('%a %m/%d %H:%M')}}</h4>
                        {% for pos, u in e.umpires.items() %}
                        <label for="{{pos}}">{{pos}}: </label>
                            {% if u.user %}
                                <a>{{u.user.firstLast}}</a>
                            {% elif not u.team_duty %}
                                None
                            {% else %}
                                {% if not u.coach_req %}
                                    {{u.team_duty}}
                                    {% if 'coach' in res.user.groups %}
                                        <button type="submit" name="request" value="{{pos}}_{{e._id}}" class="schedule-action">Request Umpire</button>
                                    {% endif %}
                                {% else %}
                                    {% if 'coach' in res.user.groups %}
                                        <button type="submit" name="request" value="{{pos}}_{{e._id}}" class="schedule-action danger">Remove Request</button>
                                    {% endif %}
                                {% endif %}

                            {% endif %}
                            <br><br>
                        {% endfor %}
                    </dialog>
                </tr>
                {% endfor %}
                
            </table>
            
        </section>
    </form>
</main>
{% endblock content %}