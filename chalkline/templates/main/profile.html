<head>
    <link rel="stylesheet" href="{{url_for('static', filename='main/home.css')}}">
</head>
{% extends "design.html" %}

{% block title %}Create Profile{% endblock title %}

{% block content %}
<main>
    <center>
        <h1>Profile</h1>
        <h3>Need Help? Check the <a href="{{url_for('docs.profile')}}">Docs</a>. Or <a href="{{url_for('main.home')}}">Return Home</a>.</h3>
        <h4></h4>
        <h3 class='error'>{{sobj.msg}}</h3>
        {% if "cal-code" in user %}
        <section>
            <h3>Chalkline iCalendar Feed</h3>
            <p>Copy the link below into the app of your choice to automatically sync events into your calendar.</p>
            <input id="cal-link" type="text" value="https://chalklinebaseball.com/invite/calendar/{{user._id}}/{{user['cal-code']}}">
            <button class="action" onclick="copyLink()">Copy Link</button>
            <script>
                function copyLink() {
                    // Get the text field
                    var copyText = document.getElementById("cal-link");
                  
                    // Select the text field
                    copyText.select();
                    copyText.setSelectionRange(0, 99999); // For mobile devices
                  
                     // Copy the text inside the text field
                    navigator.clipboard.writeText(copyText.value);
                  
                    // Alert the copied text
                    alert("Link copied! Paste into calendar app to sync events.");
                  }
            </script>
        </section>
        {% else %}
        <section>
            <form method="post">
                <h3>Get iCalendar Link</h3>
                <p>Sync all of your events in Chalkline into the calendar app of your choice!</p>
                <button class="action" type="submit" name="getCalendar" value="getCalendar">Get Link</button>
            </form>
        </section>
        {% endif %}

        {% if 'coach' in user.role or 'parent' in user.role %}
        <section>
            <form method="post" id="teams">
                <h3>My Teams</h3>
                <table id="teamCodes" class="center">
                    
                    {% if teamsList|length > 0 %}
                        <tr>
                            <th>Team Code</th>
                            <th>Team Name</th>
                            <th>Remove</th>
                        </tr>
                        {% for team in teamsList %}
                        <tr>
                            <td>{{team['teamId']}}</td>
                            <td>{{team['teamName']}}</td>
                            <td><button name="removeTeam" value="{{team['teamId']}}" class="action">Remove</button></td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <h3 class="error">No teams associated with this account.</h3>
                    {% endif %}
                    
                </table>
            </form>

            <h3>Add Team</h3>

            <form method="post">
                <table class="center">
                    <tr>
                        <td><label for="newTeam">Add Team Code</label></td>
                        <td><select name="newTeam" id="newTeam" required>
                            <option value="none" selected>Select</option>
                            {% for team in allTeams %}
                                <option value="{{team.teamId}}">{{team.teamId}} ({{team.teamName}})</option>
                            {% endfor %}
                        </select></td>
                    </tr>
                </table>
                <button class="action" type="submit" name="addTeam" value="addTeam">Add Team</button>
            </form>
        </section>
        {% endif %}
        
        <section>
            <form method="post" id="profile">
                <h3>Personal Information</h3>
                <table class="center">
                    <tr>
                        <td><label for="firstName">First Name</label></td>
                        <td><input type="text" name="firstName" id="firstName" value={{user.firstName}} required></td>
                    </tr>
                    <tr>
                        <td><label for="lastName">Last Name</label></td>
                        <td><input type="text" name="lastName" id="lastName" value={{user.lastName}} required></td>
                    </tr>
                    <tr>
                        <td><label for="email">Email</label></td>
                        <td><input type="email" name="email" id="email" value={{user.email}} required></td>
                    </tr>
                    <tr>
                        <td><label for="phone">Phone</label></td>
                        <td><input type="tel" name="phone" id="phone" pattern="[0-9]{10}" value={{user.phone}} required></td>
                    </tr>
                    <tr>
                        <td><label for="emailNotifications">Receive email alerts</label></td>
                        <td><input type="checkbox" name="emailNotifications" id="emailNotifications" checked></td>
                    </tr>
                    <tr>
                        <td><label for="phoneNotifications">Receive text alerts</label></td>
                        <td><input type="checkbox" name="phoneNotifications" id="phoneNotifications" checked></td>
                    </tr>
                    <tr>
                        <td><label for="hideEmail">Hide my email from other users</label></td>
                        <td><input type="checkbox" name="hideEmail" id="hideEmail"></td>
                    </tr>
                    <tr>
                        <td><label for="hidePhone">Hide my phone number from other users</label></td>
                        <td><input type="checkbox" name="hidePhone" id="hidePhone"></td>
                    </tr>
                </table>

                <script>
                    let user = {{user | tojson}};
                    if (!user.emailNotifications) {
                        document.getElementById('emailNotifications').checked = false;
                    }
                    if (!user.phoneNotifications) {
                        document.getElementById('phoneNotifications').checked = false;
                    }
                    if (user.hideEmail) {
                        document.getElementById('hideEmail').checked = true;
                    }
                    if (user.hidePhone) {
                        document.getElementById('hidePhone').checked = true;
                    }
                </script>
                

                <button class="action" type="submit" name="updateProfile" value="updateProfile">Save</button>
            </form>
        </section>
        <section>
            <form method="post" id="leagues">
                <h3>My Leagues</h3>
                <table id="leagues" class="center">
                        <tr>
                            <th>League</th>
                            <th>Remove</th>
                        </tr>
                        {% for loc in user.locations %}
                        <tr>
                            <td>{{loc}}</td>
                            <td><button id="removeLoc" name="removeLoc" value="{{loc}}" 
                                {% if user.locations|length == 1 %}
                                class="action disabled"
                                disabled
                                {% else %}
                                class="action"
                                {% endif %}
                                >Remove</button></td>
                        </tr>
                        {% endfor %}
                </table>
                {% if user.locations|length < 1 %}
                <p class="error">No leagues found for this account.</p>
                {% endif %}
            </form>

            <h3>Add League</h3>

            <form method="post">
                <table class="center">
                    <tr>
                        <td><label for="newLoc">Add League Code</label></td>
                        <td><input type="text" id="newLod" name="newLoc" placeholder="Code" required></td>
                    </tr>
                </table>
                <button class="action" type="submit" name="addLoc" value="addLoc">Add League</button>
            </form>
        </section>
        <section>
            <h3>Session</h3>
            <form method="post" id="logout">
                {% if admin_features is not none %}
                    <table class="center">
                        <tr>
                            <td><label for="admin-features">Admin Features: </label></td>
                            <td><select name="admin-features" id="admin-features" onchange="this.form.submit()">
                                <option value="True">On</option>
                                <option value="False">Off</option>
                            </select></td>
                        </tr>
                    </table>
                    <script>
                        document.getElementById('admin-features').value = "{{admin_features}}";
                    </script>
                {% endif %}

                <label for="location">Location: </label>
                <select name="location" id="location" onchange="this.form.submit()">
                    {% for loc in user.locations %}
                    <option value="{{loc}}">{{loc}}</option>
                    {% endfor %}
                </select>
                <script>
                    document.getElementById('location').value = "{{sobj.location}}";
                </script>

            </form>
        </section>
        <section>
            <form method="post"><button class="action" type="submit" name="logout" value="logout"><b>Sign Out</b></button></form>
        </section>
    </center>
</main>

{% endblock content %}